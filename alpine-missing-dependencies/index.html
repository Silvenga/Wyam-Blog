 <!DOCTYPE html> <html lang=en-us dir=ltr> <head> <meta charset=utf-8 /> <meta http-equiv=Content-Type content=text/html /> <meta name=HandheldFriendly content=True /> <meta name=viewport content="width=device-width,initial-scale=1"/> <meta name=generator content="Wyam + Webpack"/> <meta name=theme-color content=#000000 /> <title>Missing Dependencies With Alpine Docker Images</title> <meta name=description content="Missing dependencies when upgrading some Alpine package."> <meta property=og:type content=website> <meta property=og:title content="Missing Dependencies With Alpine Docker Images"> <meta property=og:description content="Missing dependencies when upgrading some Alpine package."> <meta property=og:locale content=en_US> <meta name=twitter:card content=summary> <meta name=twitter:site content=@Silvenga> <meta name=twitter:creator content=@Silvenga> <link rel=prefetch href=/gist-loader.js> <link rel=prefetch href=/gist-loader> <link rel=preconnect href=https://piwik.silvenga.com> <link rel=preload href=https://piwik.silvenga.com/piwik.js as=script> <link rel=preload href=/main.js as=script> <link rel=stylesheet href=/main.css> </head> <body> <header class="container-fluid s-nav" id=loading-bar role=banner> <nav class="navbar row" role=navigation> <div class="nav col-sm d-flex s-nav-left p-0"> <a class="nav-item nav-link" href=/ > <span class=logo></span> Silvenga's Blog <sub>(beta)</sub> </a> </div> <div class="nav col-sm s-nav-right p-0"> <a class="nav-item nav-link" href=/projects/ >Projects</a> <a class="nav-item nav-link" href=/about/ >About</a> <a class="nav-item nav-link" href=https://github.com/Silvenga aria-label=Github><span class=github></span></a> </div> </nav> </header> <div id=ajax-container> <script type=application/ld+json> {
  "@context" : "http://schema.org",
  "@type" : "Article",
  "headline" : "Missing Dependencies With Alpine Docker Images",
  "datePublished" : "2018-01-08T19:50:07.0000000",
  "dateModified": "2018-01-14T00:16:22.0000000-06:00",
  "author": {
      "name": "Mark Lopez"
  },
  "description": "Missing dependencies when upgrading some Alpine package."
} </script> <article class="s-content pt-4 m-4 flex-column align-items-stretch"> <div class="flex-column d-flex justify-content-center align-items-center"> <div class=s-title> <h1 class="display-4 text-center">Missing Dependencies With Alpine Docker Images</h1> <div class=text-center> Created on <time datetime=2018-01-08T19:50:07.0000000>January 08, 2018</time>. </div> <div class=text-center> Last commit <a class=text-uppercase href=https://github.com/Silvenga/silvenga.com/commit/2ba08f02>2ba08f02</a> on <time datetime=2018-01-14T00:16:22.0000000-06:00>January 14, 2018</time> - 2 total changes. </div> <hr> </div> </div> <div class="justify-content-center mt-2"> <main class="s-article d-flex flex-column align-items-center" role=main> <p></p><div class=img-container-outer data-real-path=C:\projects\silvenga-com\input\posts\content\images\2018\docker+alpine.png data-real-width=800 data-real-height=400 style=max-width:780px><div class=img-container style=padding-top:50%><p class=img-container-inner><img src="" class=img-fluid data-src=/f4f68ad2333e2b26913bd4ed5d3e6e56.png alt="Alpine + Docker = Awsome"/></p></div></div><p></p> <p>I have a lot of Docker images using Alpine Linux as a base. This is awesome when trying to get the most streamlined images possible - 24MB for a complete image is amazing!</p> <div class="code-header lang-logs"> <span class=language>Logs</span> <button class=copy data-copy-id=e1184a13fe1e4977bbf324bfea2a4837> <i class=copy-icon></i> <span>Copy</span> </button></div><pre class="lang-logs copy-pending"><code data-copy-target=e1184a13fe1e4977bbf324bfea2a4837 class=language-log># docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
tordocker_tor       latest              199b9631b0fd        5 minutes ago       24.2MB
</code></pre> <p>Soooo, lately, I've been seeing a lot of packages that I try upgrading are now broken with my Dockerfiles (even the same version is of working images fails now). Below is an extremely simple example of the Dockerfile I use for my TOR relay node.</p> <div class="code-header lang-code"> <span class=language>Code</span> <button class=copy data-copy-id=2f04748a79ec4c82bbb3434847a256d2> <i class=copy-icon></i> <span>Copy</span> </button></div><pre class="lang-code copy-pending"><code data-copy-target=2f04748a79ec4c82bbb3434847a256d2 class=language-Dockerfile>FROM alpine:3.6

RUN apk add 'gettext=0.19.8.1-r1' --no-cache
RUN apk add 'tor=0.3.1.9-r0' --no-cache \
    --repository http://dl-cdn.alpinelinux.org/alpine/edge/community

ADD entry.sh /entry.sh
ADD torrc.template.ini torrc.template.ini

CMD [&quot;/bin/sh&quot;, &quot;entry.sh&quot;]
</code></pre> <p>This Docker image does not build correctly, complaining about missing dependencies - in fact, <code>apk</code> is complaining about not have libraries normally found in OpenSSL (<code>libcrypto.so</code> and <code>libssl.so</code>).</p> <div class="code-header lang-logs"> <span class=language>Logs</span> <button class=copy data-copy-id=3e5f57f307f641ebb83f119bad653da1> <i class=copy-icon></i> <span>Copy</span> </button></div><pre class="lang-logs copy-pending"><code data-copy-target=3e5f57f307f641ebb83f119bad653da1 class=language-log>ERROR: unsatisfiable constraints:
  so:libcrypto.so.42 (missing):
    required by:
                 tor-0.3.1.9-r0[so:libcrypto.so.42]
                 tor-0.3.1.9-r0[so:libcrypto.so.42]
                 tor-0.3.1.9-r0[so:libcrypto.so.42]
                 tor-0.3.1.9-r0[so:libcrypto.so.42]
                 tor-0.3.1.9-r0[so:libcrypto.so.42]
  so:libssl.so.44 (missing):
    required by: tor-0.3.1.9-r0[so:libssl.so.44]
                 tor-0.3.1.9-r0[so:libssl.so.44]
                 tor-0.3.1.9-r0[so:libssl.so.44]
                 tor-0.3.1.9-r0[so:libssl.so.44]
                 tor-0.3.1.9-r0[so:libssl.so.44]
</code></pre> <p>So standard troubleshooting time, let's try to install OpenSSL (even though <code>apk</code> should have pulled that in).</p> <div class="code-header lang-logs"> <span class=language>Logs</span> <button class=copy data-copy-id=955a66bc2ad44586be2faf24a341aafa> <i class=copy-icon></i> <span>Copy</span> </button></div><pre class="lang-logs copy-pending"><code data-copy-target=955a66bc2ad44586be2faf24a341aafa class=language-log>/ # apk --update add openssl
fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/community/x86_64/APKINDEX.tar.gz
(1/3) Installing libcrypto1.0 (1.0.2n-r0)
(2/3) Installing libssl1.0 (1.0.2n-r0)
(3/3) Installing openssl (1.0.2n-r0)
Executing busybox-1.26.2-r5.trigger
OK: 7 MiB in 14 packages
/ # apk add 'tor=0.3.1.9-r0' --update --repository http://dl-cdn.alpinelinux.org/alpine/edge/community
fetch http://dl-cdn.alpinelinux.org/alpine/edge/community/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/community/x86_64/APKINDEX.tar.gz
ERROR: unsatisfiable constraints:
  so:libcrypto.so.42 (missing):
    required by: tor-0.3.1.9-r0[so:libcrypto.so.42] tor-0.3.1.9-r0[so:libcrypto.so.42] tor-0.3.1.9-r0[so:libcrypto.so.42] tor-0.3.1.9-r0[so:libcrypto.so.42] tor-0.3.1.9-r0[so:libcrypto.so.42]
  so:libssl.so.44 (missing):
    required by: tor-0.3.1.9-r0[so:libssl.so.44] tor-0.3.1.9-r0[so:libssl.so.44] tor-0.3.1.9-r0[so:libssl.so.44] tor-0.3.1.9-r0[so:libssl.so.44] tor-0.3.1.9-r0[so:libssl.so.44]
</code></pre> <p>Hmmm... no effect - well that sucks.</p> <p>So, after I spent a little more time looking into this problem (basically going through the changes on source control). I discovered that many Alpine maintainers are recompiling their projects to target LibreSSL. With that knowledge I went searching for where LibreSSL was hiding these days in the Alpine repositories - and alas I found the missing libraries in the <code>edge/main</code> repository.</p> <p>Below is a fixed Dockerfile:</p> <div class="code-header lang-code"> <span class=language>Code</span> <button class=copy data-copy-id=448a39192cd345dea4d18cc927295494> <i class=copy-icon></i> <span>Copy</span> </button></div><pre class="lang-code copy-pending"><code data-copy-target=448a39192cd345dea4d18cc927295494 class=language-Dockerfile>FROM alpine:3.6

RUN apk add 'gettext=0.19.8.1-r1' --no-cache
RUN apk add 'tor=0.3.1.9-r0' --no-cache \
    --repository http://dl-cdn.alpinelinux.org/alpine/edge/community \
    --repository http://dl-cdn.alpinelinux.org/alpine/edge/main

ADD entry.sh /entry.sh
ADD torrc.template.ini torrc.template.ini

CMD [&quot;/bin/sh&quot;, &quot;entry.sh&quot;]
</code></pre> <p>Notice that I added <code>--repository http://dl-cdn.alpinelinux.org/alpine/edge/main</code> as a source to the problematic line. So, yeah, working images again!</p> </main> </div> <div id=comments class=s-comments> <div class=utterances></div> </div> </article> </div> <footer class="text-center s-footer"> <hr> <span> Copyright &copy; Mark Lopez 2019. </span> <span> <a href=/humble-disclaimer/ >Disclaimer and Privacy Policy</a>. </span> <br> <span> Written under the <a href=https://creativecommons.org/licenses/by-sa/4.0/ >Creative Commons Attribution-ShareAlike 4.0 International License</a>. </span> <br> <span>Generated by Wyam + Webpack.</span> <span> Made with <span class=heart>&#10084;</span> by <a href=https://silvenga.com>Silvenga</a>. </span> </footer> <script async defer=defer src=/main.js></script> </body> </html>